# Reproducibility in OptiqAL

OptiqAL now supports deterministic random number generation for reproducible results.

## Overview

All Monte Carlo simulations in OptiqAL use a seedable pseudo-random number generator (PRNG) based on the `seedrandom` package. This ensures that simulation results are reproducible across runs when using the same seed.

## Default Behavior

By default, all simulation functions use **seed=42** for reproducibility:

```typescript
import { simulateQALYImpact } from "@/lib/qaly/simulate";

// Uses seed=42 by default
const result = simulateQALYImpact(profile, effect);
```

## Custom Seeds

You can specify a custom seed for any simulation:

```typescript
import { simulateQALYImpact } from "@/lib/qaly/simulate";

// Custom seed
const result = simulateQALYImpact(profile, effect, { seed: 123 });

// String seeds are also supported
const result2 = simulateQALYImpact(profile, effect, { seed: "my-experiment" });
```

## Reproducibility Guarantee

When using the same seed with the same input data:
- **Identical results**: All statistics (mean, median, CI95, etc.) will be exactly the same
- **Same random sequence**: The underlying random number sequence is deterministic
- **Version stable**: Results are stable across package versions (as long as the algorithm doesn't change)

## Implementation Details

The seeded RNG is implemented in `/src/lib/qaly/random.ts` and used in:
- `/src/lib/qaly/simulate.ts` - Main QALY simulation functions
- `/src/lib/qaly/confounding.ts` - Confounding adjustment sampling
- `/src/lib/qaly/state-diff.ts` - State comparison simulations
- `/src/lib/qaly/state-hazard.ts` - Hazard ratio sampling
- `/src/lib/qaly/state-lifecycle.ts` - Lifecycle simulations

All `Math.random()` calls have been replaced with `random()` from the seeded RNG.

## Paper Results

All values in `/src/lib/qaly/paper-results.ts` were generated using seed=42. This is documented in the file header and can be regenerated by running the simulation model with the same seed.

## Testing Reproducibility

To verify reproducibility:

```typescript
import { simulateQALYImpact } from "@/lib/qaly/simulate";

const options = { nSimulations: 10000, seed: 42 };

const result1 = simulateQALYImpact(profile, effect, options);
const result2 = simulateQALYImpact(profile, effect, options);

console.assert(result1.median === result2.median, "Results should be identical");
```

## Why Seed=42?

The default seed of 42 is:
1. A well-known number in computer science (from "The Hitchhiker's Guide to the Galaxy")
2. Easy to remember and recognize in code
3. Used consistently across all OptiqAL simulations for reproducibility

## Non-Reproducible Mode

If you need truly random results (e.g., for sensitivity analysis), you can:
1. Use different seeds for each run
2. Use timestamp-based seeds: `seed: Date.now()`
3. Use random string seeds: `seed: Math.random().toString()`
